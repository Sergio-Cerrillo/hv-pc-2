<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat-Sergio</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <script type="module">
        
        import { io } from 'https://cdn.socket.io/4.3.2/socket.io.esm.min.js'
                const socket = io({
            auth: {
                serverOffset: 0
            }
        })
        const form = document.getElementById('form')
        const input = document.getElementById('input')
        const messages = document.getElementById('messages')
        //DISPLAY DE MENSAJES
        socket.on('chat message', (msg, serverOffset) => {
            const item = `<li>${msg}</li>`
            messages.insertAdjacentHTML('beforeend', item)
            //CUANADO EL USUARIO RETOMA CONEXIÓN, PERMITE ACTUALIZAR MENSAJES
            socket.auth.serverOffset = serverOffset
            messages.scrollTop = messages.scrollHeight
        })
        //AL PULSAR ENVIAR, SI HAY MENSAJE EN EL INPUT, ALMACENA EL VALOR
        form.addEventListener('submit', (e) => {
            e.preventDefault()
            if (input.value) {
                socket.emit('chat message', input.value)
                input.value = ''
            }
        })
        //BOTON DE VACIAR CHAT
        document.getElementById('borrador').addEventListener('click',(e)=>{
            socket.emit('vaciar tabla')
            const prueba= document.querySelectorAll('li')
            if(prueba.length==0){
                console.log('Esta vacío')
            }else{
                prueba.forEach(e => e.remove())
            }
        })

        //VOLVER A PANTALLA INICIO
        document.getElementById('return-button').addEventListener('click',function(){
            window.location.href= 'index.html';
        })
    </script>
</head>
<body>
    <section id="return-block">
        <h2>Volver al menú principal:</h2>
        <button id="return-button">SALIR</button>
    </section>
    <section id="chat" class="contenedor">
        <button id="borrador">BORRAR CHAT</button>
        <ul id="messages"></ul>
        <form id="form">
            <input type="text" name="message" id="input" placeholder="Escribe aquí..." autocomplete="off" />
            <button type="submit">Enviar</button>
        </form>
    </section>
    <footer id="pie2">
        <p>Desarrollado por <strong>Sergio Cerrillo</strong> © 2024</p>
    </footer>
</body>
</html>